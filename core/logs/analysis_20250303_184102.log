2025-03-03 18:41:02,260 - CodeGuardian - INFO - ==================================================
2025-03-03 18:41:02,260 - CodeGuardian - INFO - Initializing CodeGuardian Analyzer
2025-03-03 18:41:02,262 - CodeGuardian - INFO - Log file: D:\codeguardian\core\logs\analysis_20250303_184102.log
2025-03-03 18:41:02,262 - VulnerabilityDB - INFO - Loading vulnerability patterns...
2025-03-03 18:41:02,263 - VulnerabilityDB - INFO - Loaded 4 CWE patterns
2025-03-03 18:41:02,264 - VulnerabilityDB - INFO - Loaded 1 mitigation methods
2025-03-03 18:41:02,264 - CodeGuardian - INFO - Loading code file: C:\Users\zhongjie_yang\Desktop\vul1.c
2025-03-03 18:41:02,265 - CodeGuardian - INFO - File loaded successfully. Size: 390 characters
2025-03-03 18:41:02,266 - CodeGuardian - INFO - Extracted 3 functions
2025-03-03 18:41:02,268 - VulnerabilityDB - ERROR - 正则表达式解析失败: unbalanced parenthesis at position 52 (CWE: CWE-401, 模式: (malloc|calloc|realloc)\s*\$.*\$\s*;\s*(?!free\s*\()))
2025-03-03 18:41:02,268 - VulnerabilityDB - ERROR - 正则表达式解析失败: unbalanced parenthesis at position 81 (CWE: CWE-404, 模式: (fopen|socket|pthread_create)\s*\$.*\$\s*;\s*(?!(fclose|close|pthread_join)\s*\()))
2025-03-03 18:41:02,269 - CodeGuardian - INFO - Initiating AI analysis...
2025-03-03 18:41:02,270 - CodeGuardian - INFO - Using OpenAI API for analysis
2025-03-03 18:41:02,625 - CodeGuardian - ERROR - OpenAI API调用失败: type object 'Config' has no attribute 'MAX_CODE_LENGTH'
Traceback (most recent call last):
  File "D:\codeguardian\core\analyzer.py", line 152, in _analyze_with_openai
    messages = self._build_messages(prompt, code, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\codeguardian\core\analyzer.py", line 176, in _build_messages
    "content": f"代码片段：\n{code[:Config.MAX_CODE_LENGTH]}\n\n上下文：{json.dumps(context)}"
                               ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'Config' has no attribute 'MAX_CODE_LENGTH'
2025-03-03 18:41:02,629 - CodeGuardian - ERROR - AI analysis failed: AI分析失败: type object 'Config' has no attribute 'MAX_CODE_LENGTH'
Traceback (most recent call last):
  File "D:\codeguardian\core\analyzer.py", line 152, in _analyze_with_openai
    messages = self._build_messages(prompt, code, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\codeguardian\core\analyzer.py", line 176, in _build_messages
    "content": f"代码片段：\n{code[:Config.MAX_CODE_LENGTH]}\n\n上下文：{json.dumps(context)}"
                               ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'Config' has no attribute 'MAX_CODE_LENGTH'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\codeguardian\core\analyzer.py", line 139, in _call_ai_engine
    return self._analyze_with_openai(prompt, code, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\codeguardian\core\analyzer.py", line 166, in _analyze_with_openai
    raise RuntimeError(f"AI分析失败: {str(e)}")
RuntimeError: AI分析失败: type object 'Config' has no attribute 'MAX_CODE_LENGTH'
2025-03-03 18:41:02,636 - CodeGuardian - ERROR - 分析过程中发生错误: AI分析失败: type object 'Config' has no attribute 'MAX_CODE_LENGTH'
Traceback (most recent call last):
  File "D:\codeguardian\core\analyzer.py", line 152, in _analyze_with_openai
    messages = self._build_messages(prompt, code, context)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\codeguardian\core\analyzer.py", line 176, in _build_messages
    "content": f"代码片段：\n{code[:Config.MAX_CODE_LENGTH]}\n\n上下文：{json.dumps(context)}"
                               ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'Config' has no attribute 'MAX_CODE_LENGTH'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\codeguardian\core\analyzer.py", line 44, in analyze
    safety_data = self._safety_analysis(context)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\codeguardian\core\analyzer.py", line 107, in _safety_analysis
    ai_report = self._call_ai_engine(
                ^^^^^^^^^^^^^^^^^^^^^
  File "D:\codeguardian\core\analyzer.py", line 139, in _call_ai_engine
    return self._analyze_with_openai(prompt, code, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\codeguardian\core\analyzer.py", line 166, in _analyze_with_openai
    raise RuntimeError(f"AI分析失败: {str(e)}")
RuntimeError: AI分析失败: type object 'Config' has no attribute 'MAX_CODE_LENGTH'
